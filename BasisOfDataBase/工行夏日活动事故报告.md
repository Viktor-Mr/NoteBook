# 工行夏日活动事故报告



## 事故现象

​	一个用户加入到了多个队伍，并在队伍完成瓜分后领取到了多份队员立减金。

## 事故描述

​	事故代码片段：在旧队伍完成拼团后，可以重复加入队伍

![image-20230827232656075](http://mk-images.tagao.top/img/image-20230827232656075.png?imageslim)

​	修改后的代码：

<img src="http://mk-images.tagao.top/img/image-20230827232901755.png?imageslim" alt="image-20230827232901755" style="zoom: 80%;" />





一把锁：队伍的锁（解决队伍在同一时间被很多用户请求）



![image-20230827233546931](http://mk-images.tagao.top/img/image-20230827233546931.png?imageslim)



两把锁：用户查询的锁（解决用户并发加入不同队伍），队伍的锁（解决队伍在同一时间被很多用户请求）

![image-20230827233305126](http://mk-images.tagao.top/img/image-20230827233305126.png?imageslim)

## 事故处理

 	先做清空库存处理，排查问题，修复问题，更新库存，实时监控活动。

